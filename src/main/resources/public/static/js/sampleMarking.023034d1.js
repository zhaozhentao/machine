(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["sampleMarking"],{"06da":function(t,e,i){"use strict";i("1b72")},"1b72":function(t,e,i){},"28a5":function(t,e,i){"use strict";var a=i("aae3"),n=i("cb7c"),o=i("ebd6"),s=i("0390"),r=i("9def"),l=i("5f1b"),c=i("520a"),p=i("79e5"),u=Math.min,h=[].push,f="split",d="length",g="lastIndex",v=4294967295,m=!p((function(){RegExp(v,"y")}));i("214f")("split",2,(function(t,e,i,p){var b;return b="c"=="abbc"[f](/(b)*/)[1]||4!="test"[f](/(?:)/,-1)[d]||2!="ab"[f](/(?:ab)*/)[d]||4!="."[f](/(.?)(.?)/)[d]||"."[f](/()()/)[d]>1||""[f](/.?/)[d]?function(t,e){var n=String(this);if(void 0===t&&0===e)return[];if(!a(t))return i.call(n,t,e);var o,s,r,l=[],p=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),u=0,f=void 0===e?v:e>>>0,m=new RegExp(t.source,p+"g");while(o=c.call(m,n)){if(s=m[g],s>u&&(l.push(n.slice(u,o.index)),o[d]>1&&o.index<n[d]&&h.apply(l,o.slice(1)),r=o[0][d],u=s,l[d]>=f))break;m[g]===o.index&&m[g]++}return u===n[d]?!r&&m.test("")||l.push(""):l.push(n.slice(u)),l[d]>f?l.slice(0,f):l}:"0"[f](void 0,0)[d]?function(t,e){return void 0===t&&0===e?[]:i.call(this,t,e)}:i,[function(i,a){var n=t(this),o=void 0==i?void 0:i[e];return void 0!==o?o.call(i,n,a):b.call(String(n),i,a)},function(t,e){var a=p(b,t,this,e,b!==i);if(a.done)return a.value;var c=n(t),h=String(this),f=o(c,RegExp),d=c.unicode,g=(c.ignoreCase?"i":"")+(c.multiline?"m":"")+(c.unicode?"u":"")+(m?"y":"g"),w=new f(m?c:"^(?:"+c.source+")",g),y=void 0===e?v:e>>>0;if(0===y)return[];if(0===h.length)return null===l(w,h)?[h]:[];var C=0,P=0,j=[];while(P<h.length){w.lastIndex=m?P:0;var x,I=l(w,m?h:h.slice(P));if(null===I||(x=u(r(w.lastIndex+(m?0:P)),h.length))===C)P=s(h,P,d);else{if(j.push(h.slice(C,P)),j.length===y)return j;for(var S=1;S<=I.length-1;S++)if(j.push(I[S]),j.length===y)return j;P=C=x}}return j.push(h.slice(C)),j}]}))},"514b":function(t,e,i){},"56b2":function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{staticClass:"big-pic-dialog",attrs:{top:"30px",visible:t.visible},on:{"update:visible":function(e){t.visible=e}}},[i("img",{staticClass:"big-img",attrs:{src:t.path,alt:""}})])},n=[],o={name:"BigPicDialog",props:{show:{type:Boolean,required:!0},path:{type:String,required:!0}},data:function(){return{visible:!1}},watch:{show:function(t){this.visible=t},visible:function(t){this.$emit("update:show",t)}}},s=o,r=(i("a05b"),i("2877")),l=Object(r["a"])(s,a,n,!1,null,null,null),c=l.exports;e["a"]={components:{BigPicDialog:c},data:function(){return{fileList:[]}},methods:{handlePreview:function(t){this.bigPicInfo={show:!0,path:t.url}},handleChange:function(t,e){this.fileList=[],e.length>0?this.fileList=[t]:this.initResultInfoFn()}}}},"8f78":function(t,e,i){"use strict";i("ac6a");e["a"]={getImgScale:function(t,e,i){return new Promise((function(a,n){if(t){var o=new Image;o.src=t,o.onload=function(){var t=o.width/e,n=o.height/i;a({scaleX:t,scaleY:n})}}}))},getEleLimitVertex:function(t){var e=[],i=[];return t&&t.length>0&&t.forEach((function(t){e.push(t.x),i.push(t.y)})),{minX:Math.min.apply(Math,e),minY:Math.min.apply(Math,i),maxX:Math.max.apply(Math,e),maxY:Math.max.apply(Math,i)}},getPolygonPoints:function(t){var e=t.get("points"),i=this.getEleLimitVertex(e),a=i.minX,n=i.minY,o=t.calcTransformMatrix(),s=e.map((function(e){return new fabric.Point(e.x-a-t.width/2,e.y-n-t.height/2)})).map((function(t){return fabric.util.transformPoint(t,o)}));return s},getCenterPointer:function(t){var e=this.getEleLimitVertex(t);return{x:(e.minX+e.maxX)/2,y:(e.minY+e.maxY)/2}},drawRoundPointInImgFn:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"red",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8;e&&e.length>0&&e.forEach((function(e){var n=new fabric.Circle({radius:a,fill:i,stroke:i,strokeWidth:0,left:e.x,top:e.y,name:"roundPointer"});t.add(n)}))},drawRectInImgFn:function(t,e){e&&e.length>0&&e.forEach((function(e){var i=new fabric.Rect({left:e.ox,top:e.oy,width:e.width,height:e.height,strokeWidth:1,stroke:"red",fill:"transparent"});t.add(i)})),t.requestRenderAll()}}},a05b:function(t,e,i){"use strict";i("b5ac")},b5ac:function(t,e,i){},c750:function(t,e,i){"use strict";i("514b")},dd24:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("section",{staticClass:"container-wrapper sample-marking-wrapper"},[i("div",{staticClass:"space-between-form"},[i("div",{staticClass:"form-group project-list-group"},[i("header",{staticClass:"group-header"},[i("h2",{staticClass:"title"},[t._v("项目")]),i("el-button",{attrs:{icon:"el-icon-plus",type:"primary",size:"mini",plain:""},on:{click:function(e){return e.stopPropagation(),t.openCreateDiolog(e)}}})],1),i("ul",{staticClass:"group-body"},t._l(t.projectList,(function(e){return i("li",{key:e,staticClass:"group-item",class:{active:t.curProjectName===e},on:{click:function(i){return t.selectProject(e)}}},[i("span",{staticClass:"item-name",attrs:{title:e}},[t._v(t._s(e))]),i("el-button",{staticClass:"upload-btn",attrs:{icon:"el-icon-plus",type:"primary",size:"mini",circle:"",plain:""},on:{click:function(i){return t.openUploadSampleDialog(e)}}})],1)})),0)]),i("div",{staticClass:"form-group result-group"},[i("header",{staticClass:"group-header"},[i("h4",{staticClass:"title"},[t._v("样本")]),i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.redrawFn}},[t._v("重新绘制")])],1),i("div",{staticClass:"group-body"},[t.sampleInfo&&t.sampleInfo.url?[i("img",{staticClass:"sample-img",attrs:{src:t.sampleInfo.url,alt:""}}),i("div",{staticClass:"canvas-box",attrs:{id:"canvasBox"}},[t.canvasWidth?i("canvas",{staticClass:"i-canvas",attrs:{id:"drawingCanvas",width:t.canvasWidth,height:t.canvasHeight}}):t._e()])]:t._e(),[i("div",{staticClass:"no-sample-tip"},[t._v("\n            无样本\n          ")])]],2),t.sampleInfo&&t.sampleInfo.url?i("div",{staticClass:"group-footer"},[i("div",{staticClass:"left"},[i("div",{staticClass:"input-group"},[i("label",{staticClass:"item-title"},[t._v("车牌号码：")]),i("el-input",{staticClass:"item-input",attrs:{size:"medium"},model:{value:t.sampleInfo.plate,callback:function(e){t.$set(t.sampleInfo,"plate",e)},expression:"sampleInfo.plate"}}),i("el-checkbox",{staticClass:"plate-type",attrs:{"true-label":"DOUBLE_LAYER","false-label":"SINGLE_LAYER"},model:{value:t.sampleInfo.plateType,callback:function(e){t.$set(t.sampleInfo,"plateType",e)},expression:"sampleInfo.plateType"}},[t._v("双层车牌")])],1),i("el-button",{attrs:{type:"primary",size:"medium"},on:{click:t.savePolygonFn}},[t._v("保  存")])],1),i("div",{staticClass:"right"},[i("el-button",{attrs:{type:"danger",size:"medium"},on:{click:t.deleteSample}},[t._v("删除图片")])],1)]):t._e()])]),i("big-pic-dialog",{attrs:{show:t.bigPicInfo.show,path:t.bigPicInfo.path},on:{"update:show":function(e){return t.$set(t.bigPicInfo,"show",e)},"update:path":function(e){return t.$set(t.bigPicInfo,"path",e)}}}),i("el-dialog",{staticClass:"big-pic-dialog",attrs:{top:"30px",visible:t.showDrawingDialog},on:{"update:visible":function(e){t.showDrawingDialog=e}}},[i("div",{staticClass:"canvas-img-wrapper"},[i("img",{staticClass:"big-img",attrs:{src:t.resultInfo.path,alt:""}}),i("div",{staticClass:"canvas-box",attrs:{id:"canvasBox"}},[t.canvasWidth>0?i("canvas",{staticStyle:{"background-size":"100% 100%"},attrs:{id:"drawingCanvas",width:t.canvasWidth,height:t.canvasHeight}}):t._e()])])]),i("el-dialog",{attrs:{title:"新建项目",visible:t.createDialogVisible,width:"30%"},on:{"update:visible":function(e){t.createDialogVisible=e}}},[i("el-form",{ref:"createProjectInfoForm",staticClass:"create-project-form",attrs:{model:t.createProjectInfo,"label-width":"100px"}},[i("el-form-item",{attrs:{label:"项目名称",prop:"project",rules:{required:!0,message:"请输入项目名称",trigger:["blur","change"]}}},[i("el-input",{model:{value:t.createProjectInfo.project,callback:function(e){t.$set(t.createProjectInfo,"project",e)},expression:"createProjectInfo.project"}})],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.createDialogVisible=!1}}},[t._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:t.confirmCreateProject}},[t._v("确 定")])],1)],1),i("el-dialog",{attrs:{title:"上传样本",visible:t.uploadSampleVisible,width:"30%"},on:{"update:visible":function(e){t.uploadSampleVisible=e}}},[i("div",{staticClass:"upload-zip-box"},[i("el-upload",{ref:"uploadSample",attrs:{action:"",drag:"",data:t.uploadSampleInfo,accept:".zip",limit:1,"file-list":t.fileList,"auto-upload":!1,"http-request":t.uploadSampleFn,"on-exceed":t.handleExceed}},[i("i",{staticClass:"el-icon-upload"}),i("p",{staticClass:"upload-txt"},[t._v("将文件拖到此处，或"),i("em",[t._v("点击上传")])])])],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.uploadSampleVisible=!1}}},[t._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:t.toUploadSample}},[t._v("确 定")])],1)])],1)},n=[],o=(i("8e6e"),i("ac6a"),i("456d"),i("28a5"),i("ade3")),s=i("2f62"),r=i("56b2"),l=(i("7f7f"),i("8f78")),c={data:function(){return{$Canvas:null,canvasWidth:0,canvasHeight:0,scaleX:1,scaleY:1,canDrawing:!1,doDrawing:!1,eventPointer:null,polygonPointers:[],polygonCircleArr:[],activeGuideLine:null,activePolygonShape:null}},mounted:function(){this.init()},methods:{init:function(){fabric.Object.prototype.originX="center",fabric.Object.prototype.originY="center",fabric.Object.prototype.cornerStyle="circle",fabric.Object.prototype.borderColor="#E3D51E",fabric.Object.prototype.cornerColor="#E3D51E",fabric.Object.prototype.cornerStrokeColor="#E3D51E",fabric.Object.prototype.transparentCorners=!1},initCanvasFn:function(){this.$Canvas||(this.$Canvas=new fabric.Canvas("drawingCanvas"),this.bindCanvasEvent());var t=this.$Canvas;t.clear(),this.doDrawing=!1,this.canDrawing=!0},dealCanvasFn:function(t){var e=this,i=this,a=t.url;a&&this.$nextTick((function(){var n=document.getElementById("canvasBox"),o=n.offsetWidth,s=n.offsetHeight,r=t.corner;e.canvasWidth=o,e.canvasHeight=s,e.$Canvas&&e.$Canvas.clear(),l["a"].getImgScale(a,o,s).then((function(t){var e=t.scaleX,a=t.scaleY;if(i.scaleX=e,i.scaleY=a,i.initCanvasFn(),r&&r.length>0){var n=r.map((function(t){var i={x:t.x/e,y:t.y/a};return i}));i.generatePolygon(n)}else i.canDrawing=!0}))}))},savePolygonFn:function(){var t=this.$Canvas.getObjects(),e=null,i=this.scaleX,a=this.scaleY;t&&t.length>0&&t.forEach((function(t){if("licenseArea"===t.name){var n=l["a"].getPolygonPoints(t);n=n.map((function(t){return t.x=Math.ceil(t.x*i),t.y=Math.ceil(t.y*a),t})),n&&n.length>2&&(e||(e=n))}})),e?this.saveSample(e):window._.showToast("请先绘制车牌识别区","error",2e3)},getCoordinates:function(t){var e=this.$Canvas.getPointer(t),i=new fabric.Point(e.x,e.y);return i},drawPolygon:function(t,e,i){var a="rgba(248, 7, 7, 0.6)",n="rgb(248, 7, 7)",o=new fabric.Polygon(t,{name:"licenseArea",left:e.x,top:e.y,fill:a,stroke:n,strokeWidth:2,opacity:.7,lockUniScaling:!1});this.$Canvas.add(o),this.$Canvas.selection=!0},generatePolygon:function(t){var e=l["a"].getCenterPointer(t);this.drawPolygon(t,e),this.clearGuidePolygon()},clearGuidePolygon:function(){var t=this.$Canvas;this.polygonCircleArr.forEach((function(e){t.remove(e)})),t.remove(this.activePolygonShape).remove(this.activeGuideLine),this.polygonPointers=[],this.polygonCircleArr=[],this.activePolygonShape=null,this.activeGuideLine=null,this.doDrawing=!1,t.requestRenderAll();var e=t.getObjects();e&&e.length>0?this.canDrawing=!1:this.canDrawing=!0},redrawFn:function(){this.$Canvas&&(this.clearGuidePolygon(),this.$Canvas.clear()),this.doDrawing=!1,this.canDrawing=!0},addPointer:function(){var t=this.$Canvas,e=this.polygonPointers,i=this.polygonCircleArr;t.selection=!1;var a=this.eventPointer,n=new fabric.Circle({radius:4,fill:"yellow",stroke:"yellow",strokeWidth:0,left:a.x,top:a.y,name:"polygonPointer",selectable:!1});0===e.length&&(n.set({fill:"#F00",scaleX:1.5,scaleY:1.5}),e=[],i=[]),e.push(a),i.push(n),this.setGuideLineStarter(a);var o=new fabric.Polygon(e,{originX:"left",originY:"top",fill:"rgba(255, 0, 0, .4)",stroke:"#F00",strokeWidth:2,opacity:.7,selectable:!1,hasBorders:!1,hasControls:!1,evented:!1});this.activePolygonShape&&t.remove(this.activePolygonShape),t.add(o),t.add(n).requestRenderAll(),this.activePolygonShape=o,this.polygonPointers=e,this.polygonCircleArr=i},setGuideLineStarter:function(t){if(this.activeGuideLine){var e={x1:t.x,x2:t.x,y1:t.y,y2:t.y};this.activeGuideLine.set(e)}else{var i=[t.x,t.y,t.x,t.y],a={strokeWidth:2,fill:"yellow",stroke:"yellow",originX:"center",originY:"center",evented:!1},n=new fabric.Line(i,a);this.activeGuideLine=n,this.$Canvas.add(n)}},drawLine:function(t){var e=this.$Canvas.getPointer(t);this.activeGuideLine.set({x2:e.x,y2:e.y}),this.$Canvas.requestRenderAll()},judgePointIsInCircle:function(t,e){if(t){var i=t.radius||10,a=t.x-e.x,n=t.y-e.y;return a*a+n*n<=i*i}return!1},bindCanvasEvent:function(){var t=this,e=this.$Canvas,i=function(e){var i=e.left,a=e.top,n=e.scaleX||1,o=e.scaleY||1,s=e.width*n,r=e.height*o,l=s/2,c=r/2,p=0,u=0,h=t.canvasWidth,f=t.canvasHeight,d=i-l,g=a-c;d<p&&(e.left=p+l),g<u&&(e.top=u+c),i+l>h&&(e.left=h-l),a+c>f&&(e.top=f-c)};e.on("mouse:down",(function(e){var i=e.e,a=e.target;if(t.canDrawing){var n=t.getCoordinates(i);t.eventPointer=n;var o=t.polygonPointers,s=o[0],r=o.length;if(3===r){if(a&&"polygonPointer"===a.name)return;o.push(n),t.generatePolygon(o),t.doDrawing=!1}else{if(a&&!s)return;t.$Canvas.selection=!1,t.addPointer(),t.doDrawing=!0}}})),e.on("mouse:move",(function(e){t.activeGuideLine&&t.drawLine(e.e)})),e.on("object:moving",(function(t){var e=t.target;i(e)})),e.on("object:moved",(function(t){var e=t.target;i(e,!0)})),e.on("object:scaling",(function(t){var e=t.target;i(e)})),e.on("object:scaled",(function(t){var e=t.target;i(e,!0)}))}}};function p(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function u(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?p(Object(i),!0).forEach((function(e){Object(o["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):p(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var h={name:"SampleMarking",mixins:[r["a"],c],data:function(){return{projectList:[],curProjectName:"",sampleInfo:null,resultInfo:{targets:[],path:"",timeSpent:""},bigPicInfo:{show:!1,path:""},createDialogVisible:!1,createProjectInfo:{project:""},uploadSampleVisible:!1,uploadSampleInfo:{project:""},fileList:[],showDrawingDialog:!1}},created:function(){this.getProject()},methods:u(u({},Object(s["b"])(["httpGet","httpPost","httpDelete"])),{},{getProject:function(){var t=this;this.projectList=[],this.httpGet(["/sample_labeling/project"]).then((function(e){t.projectList=e||[]}))},getSample:function(t){var e=this,i="/sample_labeling/sample/"+t;this.httpGet([i,,{noHints:!0}]).then((function(t){e.sampleInfo=t,e.dealCanvasFn(t)}),(function(t){e.sampleInfo=null,e.$Canvas=null}))},selectProject:function(t){this.curProjectName=t,this.getSample(t)},saveSample:function(t){var e=this,i=this.sampleInfo,a=i.plate;if(""!==a){var n={corner:t.map((function(t){return t.rgb=0,t})),plate:a.toUpperCase(),plateType:i.plateType,url:i.url},o=this.curProjectName,s="/sample_labeling/sample/"+o;this.httpPost([s,n]).then((function(t){"success"===t&&(window._.showToast("保存成功！"),e.getSample(o))}))}else window._.showToast("请先填写车牌号码","error",2e3)},deleteSample:function(){var t=this,e=this.curProjectName,i=this.sampleInfo.url,a=i.split("/"),n=a[a.length-1],o="/sample_labeling/sample/"+e+"/"+n;this.httpDelete([o]).then((function(i){"success"===i&&(window._.showToast("删除成功！"),t.getSample(e))}))},openCanvasImg:function(){var t=this,e=this.resultInfo;this.showDrawingDialog=!0,this.$nextTick((function(){t.dealCanvasFn(e)}))},openCreateDiolog:function(){this.createDialogVisible=!0,this.$refs["createProjectInfoForm"]&&this.$refs["createProjectInfoForm"].resetFields()},confirmCreateProject:function(){var t=this;this.$refs["createProjectInfoForm"].validate((function(e){if(e){var i="/sample_labeling/project",a=t.createProjectInfo.project;t.httpPost([i,{project:a},{notInData:!0}]).then((function(e){console.log(e),"success"===e?(window._.showToast("创建成功！"),t.createDialogVisible=!1,t.$refs["createProjectInfoForm"].resetFields()):window._.showToast("创建失败！")}))}}))},openUploadSampleDialog:function(t){this.uploadSampleVisible=!0,this.uploadSampleInfo.project=t,this.$refs["uploadSampleForm"]&&this.$refs["uploadSampleForm"].resetFields()},uploadSampleFn:function(t){var e=this;if(console.log(t),t.file){var i=t.data.project;console.log(i);var a=new FormData;a.append("zipFile",t.file);var n="/sample_labeling/project/sample/".concat(i);this.httpPost([n,a,{headers:{"Content-Type":"multipart/form-data"}}]).then((function(t){console.log(t),"success"===t?(window._.showToast("上传成功！"),e.getProject(),e.getSample(i),e.uploadSampleVisible=!1,e.$refs["uploadSample"].clearFiles()):window._.showToast("上传失败！","error")}))}},toUploadSample:function(){this.$refs["uploadSample"].submit()},handleExceed:function(t,e){window._.showToast("一次只能上传一个ZIP文件","warning",2e3)}})},f=h,d=(i("c750"),i("06da"),i("2877")),g=Object(d["a"])(f,a,n,!1,null,"d67b88e0",null);e["default"]=g.exports}}]);