(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["gwqRecognition"],{"2cc7":function(t,i,e){"use strict";e("5878")},"56b2":function(t,i,e){"use strict";var a=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("el-dialog",{staticClass:"big-pic-dialog",attrs:{top:"30px",visible:t.visible},on:{"update:visible":function(i){t.visible=i}}},[e("img",{staticClass:"big-img",attrs:{src:t.path,alt:""}})])},n=[],s={name:"BigPicDialog",props:{show:{type:Boolean,required:!0},path:{type:String,required:!0}},data:function(){return{visible:!1}},watch:{show:function(t){this.visible=t},visible:function(t){this.$emit("update:show",t)}}},r=s,o=(e("a05b"),e("2877")),c=Object(o["a"])(r,a,n,!1,null,null,null),l=c.exports;i["a"]={components:{BigPicDialog:l},data:function(){return{fileList:[]}},methods:{handlePreview:function(t){this.bigPicInfo={show:!0,path:t.url}},handleChange:function(t,i){this.fileList=[],i.length>0?this.fileList=[t]:this.initResultInfoFn()}}}},5878:function(t,i,e){},"6eb4":function(t,i,e){"use strict";e.r(i);var a=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("section",{staticClass:"container-wrapper"},[e("div",{staticClass:"center-form"},[e("div",{staticClass:"form-group"},[e("header",{staticClass:"group-header"},[t._v("高位枪图片")]),e("div",{staticClass:"group-body"},[e("el-upload",{attrs:{action:"",drag:"","list-type":"picture-card",accept:"image/jpg,image/jpeg,image/png",limit:2,"file-list":t.fileList,"http-request":t.uploadPlateFn,"on-preview":t.handlePreview,"on-change":t.handleChange,"on-remove":t.handleChange}},[e("i",{staticClass:"el-icon-upload"}),e("p",{staticClass:"upload-txt"},[t._v("将文件拖到此处，或"),e("em",[t._v("点击上传")])])])],1)]),e("div",{staticClass:"form-group"},[e("header",{staticClass:"group-header"},[t._v("识别结果")]),e("div",{staticClass:"group-body"},[e("div",{staticClass:"group-item"},[e("label",{staticClass:"item-title"},[t._v("识别结果：")]),e("span",{staticClass:"item-con"},[t.resultInfo.path?e("a",{staticClass:"edit-a",attrs:{href:"javascript:;"},on:{click:t.openCanvasImg}},[t._v("查看图片")]):t._e()])]),e("div",{staticClass:"group-item"},[e("label",{staticClass:"item-title"},[t._v("识别耗时：")]),e("span",{staticClass:"item-con"},[t._v(t._s(t._f("formatTimeSpent")(t.resultInfo.timeSpent)))])])])]),e("div",{staticClass:"form-group"},[e("el-button",{attrs:{type:"primary",size:"medium"},on:{click:t.initResultInfoFn}},[t._v("重  置")])],1)]),e("big-pic-dialog",{attrs:{show:t.bigPicInfo.show,path:t.bigPicInfo.path},on:{"update:show":function(i){return t.$set(t.bigPicInfo,"show",i)},"update:path":function(i){return t.$set(t.bigPicInfo,"path",i)}}}),e("el-dialog",{staticClass:"big-pic-dialog",attrs:{top:"30px",visible:t.showDrawingDialog},on:{"update:visible":function(i){t.showDrawingDialog=i}}},[e("div",{staticClass:"canvas-img-wrapper"},[e("img",{staticClass:"big-img",attrs:{src:t.resultInfo.path,alt:""}}),e("div",{staticClass:"canvas-box",attrs:{id:"canvasBox"}},[t.canvasWidth>0?e("canvas",{staticStyle:{"background-size":"100% 100%"},attrs:{id:"drawingCanvas",width:t.canvasWidth,height:t.canvasHeight}}):t._e()])])])],1)},n=[],s=(e("8e6e"),e("ac6a"),e("456d"),e("ade3")),r=e("2f62"),o=e("56b2"),c=e("8f78"),l={data:function(){return{canvasWidth:0,canvasHeight:0,scaleX:1,scaleY:1}},methods:{dealCanvasFn:function(t){var i=this,e=t.path;if(e){var a=document.getElementById("canvasBox"),n=a.offsetWidth,s=a.offsetHeight;this.canvasWidth=n,this.canvasHeight=s,c["a"].getImgScale(e,n,s).then((function(e){var a=e.scaleX,n=e.scaleY;i.scaleX=a,i.scaleY=n;var s=t.targets,r=s.map((function(t){var i={x:t.x/a,y:t.y/n};return i}));if(r&&r.length>0){var o=new fabric.StaticCanvas("drawingCanvas");fabric.Object.prototype.originX="center",fabric.Object.prototype.originY="center",c["a"].drawRoundPointInImgFn(o,r)}}))}}}};function h(t,i){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);i&&(a=a.filter((function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable}))),e.push.apply(e,a)}return e}function u(t){for(var i=1;i<arguments.length;i++){var e=null!=arguments[i]?arguments[i]:{};i%2?h(Object(e),!0).forEach((function(i){Object(s["a"])(t,i,e[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):h(Object(e)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))}))}return t}var f={name:"GwqRecognition",mixins:[o["a"],l],data:function(){return{resultInfo:{targets:[],path:"",timeSpent:""},bigPicInfo:{show:!1,path:""},showDrawingDialog:!1}},created:function(){this.initResultInfoFn()},methods:u(u({},Object(r["b"])(["httpPost"])),{},{initResultInfoFn:function(){this.resultInfo={targets:[],path:"",timeSpent:""},this.fileList=[]},uploadPlateFn:function(t){var i=this,e=t.file;if(console.log(t),e){var a=new FormData;a.append("file",e),this.httpPost(["/algorithm_server/hpc",a]).then((function(t){var a=JSON.parse(JSON.stringify(t)),n=e.type,s=new Blob([e],{type:n}),r=URL.createObjectURL(s);a.path=r,i.resultInfo=a,a.targets&&a.targets.length>0&&i.openCanvasImg()}))}},openCanvasImg:function(){var t=this,i=this.resultInfo;this.showDrawingDialog=!0,this.$nextTick((function(){t.dealCanvasFn(i)}))}}),watch:{showDrawingDialog:function(t){t||(this.canvasWidth=0,this.canvasHeight=0)}}},p=f,g=(e("2cc7"),e("f93f"),e("2877")),d=Object(g["a"])(p,a,n,!1,null,"6a3a3612",null);i["default"]=d.exports},"8f78":function(t,i,e){"use strict";e("ac6a");i["a"]={getImgScale:function(t,i,e){return new Promise((function(a,n){if(t){var s=new Image;s.src=t,s.onload=function(){var t=s.width/i,n=s.height/e;a({scaleX:t,scaleY:n})}}}))},getEleLimitVertex:function(t){var i=[],e=[];return t&&t.length>0&&t.forEach((function(t){i.push(t.x),e.push(t.y)})),{minX:Math.min.apply(Math,i),minY:Math.min.apply(Math,e),maxX:Math.max.apply(Math,i),maxY:Math.max.apply(Math,e)}},getPolygonPoints:function(t){var i=t.get("points"),e=this.getEleLimitVertex(i),a=e.minX,n=e.minY,s=t.calcTransformMatrix(),r=i.map((function(i){return new fabric.Point(i.x-a-t.width/2,i.y-n-t.height/2)})).map((function(t){return fabric.util.transformPoint(t,s)}));return r},getCenterPointer:function(t){var i=this.getEleLimitVertex(t);return{x:(i.minX+i.maxX)/2,y:(i.minY+i.maxY)/2}},drawRoundPointInImgFn:function(t,i){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"red",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8;i&&i.length>0&&i.forEach((function(i){var n=new fabric.Circle({radius:a,fill:e,stroke:e,strokeWidth:0,left:i.x,top:i.y,name:"roundPointer"});t.add(n)}))},drawRectInImgFn:function(t,i){i&&i.length>0&&i.forEach((function(i){var e=new fabric.Rect({left:i.ox,top:i.oy,width:i.width,height:i.height,strokeWidth:1,stroke:"red",fill:"transparent"});t.add(e)})),t.requestRenderAll()}}},"92b2":function(t,i,e){},a05b:function(t,i,e){"use strict";e("b5ac")},b5ac:function(t,i,e){},f93f:function(t,i,e){"use strict";e("92b2")}}]);